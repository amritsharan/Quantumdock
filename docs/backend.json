{
  "entities": {
    "Molecule": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Molecule",
      "type": "object",
      "description": "Represents a molecule structure.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the molecule entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the molecule."
        },
        "smiles": {
          "type": "string",
          "description": "SMILES string representation of the molecule."
        },
        "pdbFile": {
          "type": "string",
          "description": "PDB file content of the molecule."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Molecule)"
        }
      },
      "required": [
        "id",
        "name",
        "smiles",
        "userId"
      ]
    },
    "TargetProtein": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TargetProtein",
      "type": "object",
      "description": "Represents a biological target protein.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the target protein entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the target protein."
        },
        "sequence": {
          "type": "string",
          "description": "Amino acid sequence of the target protein."
        },
        "structure": {
          "type": "string",
          "description": "3D structure data of the protein (e.g., PDB format)."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N TargetProtein)"
        }
      },
      "required": [
        "id",
        "name",
        "sequence",
        "structure",
        "userId"
      ]
    },
    "DockingResult": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DockingResult",
      "type": "object",
      "description": "Represents the result of a docking simulation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the docking result entity."
        },
        "moleculeId": {
          "type": "string",
          "description": "Reference to Molecule. (Relationship: Molecule 1:N DockingResult)"
        },
        "targetProteinId": {
          "type": "string",
          "description": "Reference to TargetProtein. (Relationship: TargetProtein 1:N DockingResult)"
        },
        "dockingScore": {
          "type": "number",
          "description": "The docking score of the simulation."
        },
        "refinedEnergy": {
          "type": "number",
          "description": "Refined binding energy after quantum refinement (VQE/QAOA)."
        },
        "pose": {
          "type": "string",
          "description": "3D coordinates of the docked pose."
        },
        "bindingAffinity": {
          "type": "number",
          "description": "Predicted binding affinity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N DockingResult)"
        }
      },
      "required": [
        "id",
        "moleculeId",
        "targetProteinId",
        "dockingScore",
        "refinedEnergy",
        "pose",
        "bindingAffinity",
        "userId"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "LoginHistory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LoginHistory",
      "type": "object",
      "description": "Represents a user's login session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the login history record."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user."
        },
        "loginTime": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the user logged in."
        },
        "logoutTime": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the user logged out."
        },
        "status": {
          "type": "string",
          "enum": ["active", "inactive"],
          "description": "The status of the login session."
        }
      },
      "required": [
        "id",
        "userId",
        "loginTime",
        "status"
      ]
    },
    "DockingSimulation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DockingSimulation",
      "type": "object",
      "description": "Represents a single docking simulation event performed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the simulation record."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who performed the simulation."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the simulation was run."
        },
        "moleculeSmiles": {
          "type": "string",
          "description": "The SMILES string of the molecule used."
        },
        "proteinTarget": {
          "type": "string",
          "description": "The name of the protein target used."
        },
        "bindingAffinity": {
          "type": "number",
          "description": "The predicted binding affinity result."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "moleculeSmiles",
        "proteinTarget",
        "bindingAffinity"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  All user-specific data is stored under this path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/molecules/{moleculeId}",
        "definition": {
          "entityName": "Molecule",
          "schema": {
            "$ref": "#/backend/entities/Molecule"
          },
          "description": "Stores molecule data for a specific user.  Path-based ownership ensures only the user can access these documents.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "moleculeId",
              "description": "The unique identifier of the molecule."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/targetProteins/{targetProteinId}",
        "definition": {
          "entityName": "TargetProtein",
          "schema": {
            "$ref": "#/backend/entities/TargetProtein"
          },
          "description": "Stores target protein data for a specific user. Path-based ownership ensures only the user can access these documents.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "targetProteinId",
              "description": "The unique identifier of the target protein."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dockingResults/{dockingResultId}",
        "definition": {
          "entityName": "DockingResult",
          "schema": {
            "$ref": "#/backend/entities/DockingResult"
          },
          "description": "Stores docking result data for a specific user. Path-based ownership ensures only the user can access these documents.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "dockingResultId",
              "description": "The unique identifier of the docking result."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/loginHistory/{historyId}",
        "definition": {
          "entityName": "LoginHistory",
          "schema": {
            "$ref": "#/backend/entities/LoginHistory"
          },
          "description": "Stores login history for a specific user. Path-based ownership ensures only the user can access their own login records.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "historyId",
              "description": "The unique identifier of the login history record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dockingSimulations/{simulationId}",
        "definition": {
          "entityName": "DockingSimulation",
          "schema": {
            "$ref": "#/backend/entities/DockingSimulation"
          },
          "description": "Stores docking simulation records for a specific user. Path-based ownership ensures only the user can access their own simulation data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "simulationId",
              "description": "The unique identifier of the docking simulation record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to reflect the relationships between users and their data in the QuantumDock application. It leverages path-based ownership for private user data, ensuring clear authorization and efficient queries. The structure prioritizes Authorization Independence by ensuring that each document contains all the necessary information to validate access without needing to perform `get()` operations on parent documents.\n\nSpecifically:\n\n*   **Users Collection:** Stores user profiles.\n*   **User-Owned Data:** Molecules, TargetProteins, DockingResults, LoginHistory, and DockingSimulations are stored as subcollections under each user's document. This enforces clear ownership and simplifies security rules. Using hierarchical paths automatically ensures that only the owning user has access to their data, eliminating the need for complex authorization logic."
  }
}
