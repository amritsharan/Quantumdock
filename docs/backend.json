{
  "entities": {
    "Molecule": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Molecule",
      "type": "object",
      "description": "Represents a molecule structure.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the molecule entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the molecule."
        },
        "smiles": {
          "type": "string",
          "description": "SMILES string representation of the molecule."
        },
        "pdbFile": {
          "type": "string",
          "description": "PDB file content of the molecule."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Molecule)"
        }
      },
      "required": [
        "id",
        "name",
        "smiles",
        "userId"
      ]
    },
    "TargetProtein": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TargetProtein",
      "type": "object",
      "description": "Represents a biological target protein.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the target protein entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the target protein."
        },
        "sequence": {
          "type": "string",
          "description": "Amino acid sequence of the target protein."
        },
        "structure": {
          "type": "string",
          "description": "3D structure data of the protein (e.g., PDB format)."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N TargetProtein)"
        }
      },
      "required": [
        "id",
        "name",
        "sequence",
        "structure",
        "userId"
      ]
    },
    "DockingResult": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DockingResult",
      "type": "object",
      "description": "Represents the result of a docking simulation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the docking result entity."
        },
        "moleculeId": {
          "type": "string",
          "description": "Reference to Molecule. (Relationship: Molecule 1:N DockingResult)"
        },
        "targetProteinId": {
          "type": "string",
          "description": "Reference to TargetProtein. (Relationship: TargetProtein 1:N DockingResult)"
        },
        "dockingScore": {
          "type": "number",
          "description": "The docking score of the simulation."
        },
        "refinedEnergy": {
          "type": "number",
          "description": "Refined binding energy after quantum refinement (VQE/QAOA)."
        },
        "pose": {
          "type": "string",
          "description": "3D coordinates of the docked pose."
        },
        "bindingAffinity": {
          "type": "number",
          "description": "Predicted binding affinity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N DockingResult)"
        }
      },
      "required": [
        "id",
        "moleculeId",
        "targetProteinId",
        "dockingScore",
        "refinedEnergy",
        "pose",
        "bindingAffinity",
        "userId"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  All user-specific data is stored under this path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/molecules/{moleculeId}",
        "definition": {
          "entityName": "Molecule",
          "schema": {
            "$ref": "#/backend/entities/Molecule"
          },
          "description": "Stores molecule data for a specific user.  Path-based ownership ensures only the user can access these documents.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "moleculeId",
              "description": "The unique identifier of the molecule."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/targetProteins/{targetProteinId}",
        "definition": {
          "entityName": "TargetProtein",
          "schema": {
            "$ref": "#/backend/entities/TargetProtein"
          },
          "description": "Stores target protein data for a specific user. Path-based ownership ensures only the user can access these documents.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "targetProteinId",
              "description": "The unique identifier of the target protein."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dockingResults/{dockingResultId}",
        "definition": {
          "entityName": "DockingResult",
          "schema": {
            "$ref": "#/backend/entities/DockingResult"
          },
          "description": "Stores docking result data for a specific user. Path-based ownership ensures only the user can access these documents.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "dockingResultId",
              "description": "The unique identifier of the docking result."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to reflect the relationships between users, molecules, target proteins, and docking results in the QuantumDock application. It leverages path-based ownership for private user data, ensuring clear authorization and efficient queries. The structure prioritizes Authorization Independence by ensuring that each document contains all the necessary information to validate access without needing to perform `get()` operations on parent documents.\n\nSpecifically:\n\n*   **Users Collection:** Stores user profiles.\n*   **User-Owned Data:** Molecules, TargetProteins, and DockingResults are stored as subcollections under each user's document (`/users/{userId}/molecules/{moleculeId}`, `/users/{userId}/targetProteins/{targetProteinId}`, and `/users/{userId}/dockingResults/{dockingResultId}`). This enforces clear ownership and simplifies security rules. Using hierarchical paths automatically ensures that only the owning user has access to their data, eliminating the need for complex authorization logic.\n\nThis design supports the required QAPs (Rules are not Filters) because listing operations will always be scoped to a specific user's data, based on the path. There is no need to filter based on user ID within the rules themselves, as the path inherently provides that context."
  }
}